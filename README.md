# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


# Архитектура Проекта

### Модуль Model
**Описание:** Модели в MVP отвечают за бизнес-логику и обработку данных приложения. Они независимы от пользовательского интерфейса и взаимодействуют с источниками данных, такими как базы данных или внешние сервисы.

#### 1. **AppState**
- **Описание:** Управляет централизованно состоянием приложения, включая данные о пользователях, продуктах и заказах.
- **Методы:**
  - `setCatalog(data)`: Загружает и обновляет список продуктов в приложении.
  - `addToBasket(item)`: Добавляет элемент в корзину пользователя.
  - `removeFromBasket(item)`: Удаляет элемент из корзины пользователя.
  - `clearBasket()`: Полностью очищает корзину.
- **Наследование:** Происходит от класса `Model`, использует его метод `emitChanges` для уведомления о изменениях.

#### 2. **Model**
- **Описание:** Представляет собой общий класс для всех моделей, поддерживает механизмы оповещения об изменениях в данных.
- **Методы:**
  - `emitChanges(event, data)`: Испускает события изменений, которые могут быть перехвачены любым компонентом или презентером.

### Модуль View

**Описание:** View компоненты отвечают за отображение данных моделей в пользовательском интерфейсе. Они реагируют на изменения в моделях и обновляют интерфейс.

#### 1. **Card**
- **Описание:** Визуальное представление продукта в виде карточки.
- **Методы:** 
  - `setTitle(title)`: Устанавливает название продукта.
  - `setDescription(desc)`: Устанавливает описание продукта.
  - `setPrice(price)`: Устанавливает цену продукта.
- **Наследование:** Создан на базе `Component`, использует его методы для отрисовки и обновления.

#### 2. **Component**
- **Описание:** Базовый класс для всех элементов интерфейса, предоставляет общие методы для управления DOM.
- **Методы:**
  - `render()`: Генерирует HTML код компонента.
  - `setDisabled(state)`: Устанавливает или снимает блокировку элемента.
  - `setVisible(state)`: Показывает или скрывает элемент.

#### 3. **Basket**
- **Описание:** Компонент для отображения и управления корзиной покупок.
- **Методы:**
  - `updateItems()`: Обновляет список товаров в корзине.
  - `calculateTotal()`: Вычисляет общую стоимость товаров в корзине.
- **Наследование:** Расширяет `Component`, использует его возможности для взаимодействия с пользователем.

### Модуль Presenter

- **Описание:** Сердце архитектуры MVP, координирует взаимодействие между моделью и представлением.
- **Роли:**
  - Обработка ввода от пользователя и его перенаправление в модель.
  - Отображение актуальных данных из модели в представление.

### Примеры взаимодействия компонентов

- **Обновление данных о продукте:**
  1. Пользователь выбирает продукт в компоненте `Card` и изменяет его количество.
  2. `Presenter` перехватывает этот ввод и вызывает `updateProduct` в `AppState`.
  3. `AppState` изменяет количество продукта в своем состоянии и испускает событие `productUpdated`.
  4. `Card` подписан на событие `productUpdated` и обновляет отображение продукта с новым количеством.

- **Оформление заказа:**
  1. Пользователь нажимает кнопку "Оформить заказ" в `Basket`.
  2. `Presenter` получает уведомление и запрашивает данные корзины у `AppState`.
  3. `AppState` предоставляет данные, и `Presenter` инициирует процесс проверки и подтверждения заказа.
  4. После подтверждения заказа `AppState` обновляет состояние заказа и корзины, а `Presenter` обновляет `View`, отображая статус успешного оформления заказа.


### Коммуникация и Управление Событиями
- **EventEmitter:** Используется для организации шаблона "наблюдатель" в приложении.
- **Методы:** `on(event, handler)`, `off(event, handler)`, `emit(event, data)` – методы для подписки на события, отписки от событий и их трансляции.

### Сетевые Запросы и Взаимодействие с API
- **API:** Класс, обеспечивающий взаимодействие с внешними API.
- **Методы:**
  - `get(url)`: Выполняет GET-запрос.
  - `post(url, data)`: Выполняет POST-запрос.
  - `handleResponse(response)`: Обрабатывает ответ сервера, превращая его в удобный для работы формат или обрабатывая ошибки.

#### Основные типы данных

```typescript
// Типы данных для категорий продуктов
export type TProductCategory = 'soft-skill' | 'other' | 'additional' | 'button' | 'hard-skill';

// Типы данных для методов оплаты
export type TPaymentMethod = 'online' | 'cash-on-delivery' | 'credit-card';
```

#### Интерфейсы моделей данных

```typescript
// Интерфейс для описания продукта
export interface IProduct {
    productId: string;
    categoryName: TProductCategory;
    productName: string;
    description: string;
    price: number | null;
    imageUrl?: string;
    isSelected?: boolean;
}

// Интерфейс для элементов корзины
export interface IBasketItem {
    product: IProduct;
    quantity: number;
    subtotal: number;
}

// Интерфейс для данных корзины
export interface IBasket {
    items: IBasketItem[];
    totalAmount: number;
}

// Интерфейс для формы заказа
export interface IOrderDetails {
    paymentMethod: TPaymentMethod;
    shippingAddress: string;
    contactEmail: string;
    contactPhone: string;
    estimatedDeliveryDate?: Date;
}

// Интерфейс для ответа об успешном оформлении заказа
export interface IOrderConfirmation {
    orderId: string;
    orderTotal: number;
    confirmationMessage: string;
}

// Интерфейс для состояния приложения
export interface IApplicationState {
    productCatalog: IProduct[];
    shoppingBasket: IBasket;
    currentOrder: IOrderDetails | null;
    previewProduct: IProduct | null;
}

// Интерфейс для действий с карточкой товара
export interface IProductCardActions {
    onAddToCart: (productId: string, quantity: number) => void;
    onRemoveFromCart: (productId: string, quantity: number) => void;
}
```

### Безопасность и обработка ошибок
- **Обработка ответов API:** Метод `handleResponse` в классе `API` проверяет статус ответа и, в случае ошибок, генерирует исключение, которое может быть перехвачено и обработано для отображения сообщения об ошибке пользователю.
- **Валидация данных:** Перед отправкой данных на сервер или перед их сохранением в модели, данные проходят валидацию в презентере или модели, чтобы предотвратить сохранение некорректных данных.

### Тестирование и поддержка
- **Модульные тесты:** Каждый компонент (Model, View, Presenter) тестируется отдельно. Для `View` проверяется корректность отображения элементов, для `Model` — правильность обработки данных, для `Presenter` — корректность реакции на пользовательский ввод и изменения модели.
- **Интеграционные тесты:** Проверяется взаимодействие между различными слоями и компонентами, а также корректность работы с API.

### Развитие и масштабирование
- **Добавление новых функций:** Благодаря чёткому разделению ответственности, в систему легко интегрировать новые функции. Например, добавление нового типа платежей требует изменений в `Model` и добавления новых методов в `Presenter` для обработки.
- **Масштабирование:** Приложение может быть масштабировано путём добавления новых модулей или расширения существующих компонентов, не нарушая общую структуру и архитектуру.
